# Social Scribe ü§ñüìù‚ú®

**Stop manually summarizing meetings and drafting social media posts! Social Scribe leverages AI to transform your meeting transcripts into engaging follow-up emails and platform-specific social media content, ready to share.**

Social Scribe is a powerful Elixir and Phoenix LiveView application designed to connect to your calendars, automatically send an AI notetaker to your virtual meetings, provide accurate transcriptions via Recall.ai, and then utilize Google Gemini's advanced AI to draft compelling follow-up emails and social media posts through user-defined automation rules. This project was developed with significant AI assistance, as encouraged by the challenge, to rapidly build a feature-rich application.

---

## üåü Key Features Implemented

* **Google Calendar Integration:**
    * Seamlessly log in with your Google Account.
    * Connect multiple Google accounts to aggregate events from all your calendars.
    * View your upcoming calendar events directly within the app's dashboard.
* **Automated Meeting Transcription with Recall.ai:**
    * Toggle a switch for any calendar event to have an AI notetaker attend.
    * The app intelligently parses event details (description, location) to find Zoom or Google Meet links.
    * Recall.ai bot joins meetings a configurable number of minutes before the start time (currently default, setting to be added to UI).
    * **Bot ID Management:** Adheres to challenge constraints by tracking individually created `bot_id`s and not using the general `/bots` endpoint.
    * **Polling for Media:** Implements a robust polling mechanism (via Oban) to check bot status and retrieve transcripts/media, as webhooks cannot be used with the shared API key.
* **AI-Powered Content Generation (Google Gemini):**
    * Automatically drafts a follow-up email summarizing key discussion points and action items from the meeting transcript.
    * **Custom Automations:** Users can create, view, and manage automation templates, defining custom prompts, target platforms (LinkedIn, Facebook), and descriptions to generate specific marketing content or other post types.
* **Social Media Integration & Posting:**
    * Securely connect LinkedIn and Facebook accounts via OAuth on the Settings page.
    * **Direct Posting:** Generated content can be posted directly to the user's connected LinkedIn profile or a user-managed Facebook Page.
* **Meeting Management & Review:**
    * View a list of past processed meetings, showing attendees, start time, and platform logo (platform logo to be enhanced).
    * Click into any past meeting to view its full transcript, the AI-generated follow-up email draft, and a list of social media posts generated by configured automations.
    * **Copy & Post Buttons:** Social media drafts are presented with a "Copy" button (implemented via JS Hooks) for easy content reuse and direct "Post" buttons for integrated platforms.
* **Modern Tech Stack & Background Processing:**
    * Built with Elixir & Phoenix LiveView for a real-time, interactive experience.
    * Utilizes Oban for robust background job processing (calendar syncing, bot status polling, AI content generation).
    * Secure credential management for all connected services using Ueberauth.

---

## App Flow

* **Login With Google and Meetins Sync:**
    ![Auth Flow](https://youtu.be/RM7YSlu5ZDg)

* **Creating Automations:**
    ![Creating Automations](https://youtu.be/V2tIKgUQYEw)

* **Meetings Recordings:**
    ![Meetings Recording](https://youtu.be/pZrLsoCfUeA)

* **Facebook Login:**
    ![Facebook Login](https://youtu.be/JRhPqCN-jeI)

* **Facebook Post:**
    ![Facebook Post](https://youtu.be/4w6zpz0Rn2o)

* **LinkedIn Login & Post:**
    ![LinkedIn Login and Post](https://youtu.be/wuD_zefGy2k)
---

## üì∏ Screenshots & GIFs


* **Dashboard View:**
    ![Dashboard View](readme_assets/dashboard_view.png)


* **Automation Configuration UI:**
    ![Automation Configuration](readme_assets/edit_automation.png)

---

## üõ† Tech Stack

* **Backend:** Elixir, Phoenix LiveView
* **Database:** PostgreSQL
* **Background Jobs:** Oban
* **Authentication:** Ueberauth (for Google, LinkedIn, Facebook, HubSpot, Salesforce OAuth)
* **Meeting Transcription:** Recall.ai API
* **AI Content Generation:** Google Gemini API (Flash models)
* **Frontend:** Tailwind CSS, Heroicons (via `tailwind.config.js`)
* **Progress Bar:** Topbar.js for page loading indication.

---

## üöÄ Local Setup

### Prerequisites

| Tool | Minimum version |
|------|----------------|
| Elixir | 1.15+ |
| Erlang/OTP | 26+ |
| PostgreSQL | 14+ |
| Node.js | 18+ (for Tailwind/esbuild asset compilation) |

### Step-by-step

```bash
# 1. Clone the repository
git clone https://github.com/fparadas/social_scribe.git
cd social_scribe

# 2. Copy the example env file and fill in your credentials
cp .env.example .env
# Edit .env ‚Äî see "Required environment variables" below

# 3. Install Elixir dependencies
mix deps.get

# 4. Create the database and run all migrations
mix ecto.create && mix ecto.migrate

# 5. Install JavaScript/CSS build tools (first run only)
mix assets.setup

# 6. Source your env file, then start the server
source .env && mix phx.server
```

Visit [http://localhost:4000](http://localhost:4000).

> **Tip:** Use `iex -S mix phx.server` instead if you want an interactive shell.

---

### Required environment variables

All variables are documented in [`.env.example`](.env.example).
The table below lists the **mandatory** ones ‚Äî the server will start without
the optional ones, but those features will be disabled.

| Variable | Required for |
|---|---|
| `GOOGLE_CLIENT_ID` / `GOOGLE_CLIENT_SECRET` / `GOOGLE_REDIRECT_URI` | Google login + Calendar sync |
| `RECALL_API_KEY` / `RECALL_REGION` | AI meeting bots |
| `GEMINI_API_KEY` | AI email/post drafts |
| `LINKEDIN_CLIENT_ID` / `LINKEDIN_CLIENT_SECRET` / `LINKEDIN_REDIRECT_URI` | LinkedIn posting |
| `FACEBOOK_CLIENT_ID` / `FACEBOOK_CLIENT_SECRET` / `FACEBOOK_REDIRECT_URI` | Facebook posting |
| `HUBSPOT_CLIENT_ID` / `HUBSPOT_CLIENT_SECRET` | HubSpot contact sync |
| `SALESFORCE_CLIENT_ID` / `SALESFORCE_CLIENT_SECRET` | Salesforce contact sync |

---

### Verifying background jobs (Oban)

After starting the server you can confirm Oban is running:

```elixir
# In: iex -S mix phx.server
iex> Process.whereis(Oban)        # should return a PID, not nil
iex> Oban.check_queue(:polling)   # %{limit: 5, paused: false, ...}
iex> Oban.check_queue(:default)   # %{limit: 10, paused: false, ...}
```

Configured queues:

| Queue | Concurrency | Workers |
|---|---|---|
| `default` | 10 | General-purpose jobs |
| `ai_content` | 10 | `AIContentGenerationWorker` |
| `polling` | 5 | `BotStatusPoller` (every 2 min), `HubspotTokenRefresher` (every 5 min) |

---

## üõ† Troubleshooting

### Google OAuth ‚Äî missing `refresh_token`

**Symptom:** Calendar sync works once, but breaks after the session expires.

**Cause:** Google only issues a `refresh_token` on the first authorization or
when `prompt=consent` is forced.  The app sets `access_type=offline` and
`prompt=consent select_account` automatically, but a previously stored
credential may be missing the token.

**Fix:** Disconnect the Google account on the Settings page, then reconnect to
force a new consent screen and a fresh `refresh_token`.

---

### Google Calendar API ‚Äî no events visible

**Symptom:** Dashboard shows no calendar events after connecting Google.

**Checklist:**
1. Ensure the Google Cloud project has the **Google Calendar API** enabled.
2. Verify the OAuth consent screen includes the `https://www.googleapis.com/auth/calendar.readonly` scope.
3. Reconnect the Google account so the updated scope is consented to.

---

### Recall.ai bot ‚Äî bot never joins the meeting

**Symptom:** You toggled "Record Meeting?" but no bot appears in the call.

**Checklist:**
1. Verify `RECALL_API_KEY` and `RECALL_REGION` are set correctly.
2. Confirm the calendar event has a detectable meeting link (Zoom or Google Meet) in the `location` or `description` field.
3. Run `Oban.check_queue(:polling)` in `iex` ‚Äî the `BotStatusPoller` cron runs every 2 minutes.
4. Check the server log for errors from `BotStatusPoller` or `RecallApi`.

---

### Salesforce ‚Äî 401 / session expired

**Symptom:** Salesforce contact search or update returns 401 Unauthorized.

**Fix:** Disconnect and reconnect the Salesforce account on the Settings page.
Access tokens expire based on the Connected App's token policy (default 2 hours).

**Prevention:** Set *Token Timeout Policy* to "No expiration" in the Connected
App's OAuth Policies in Salesforce Setup.

---

### Salesforce ‚Äî `FIELD_INTEGRITY_EXCEPTION` on address update

**Symptom:** Updating `MailingState` / `MailingCountry` raises
`FIELD_INTEGRITY_EXCEPTION`.

**Cause:** The org has **State and Country/Territory Picklists** enabled.
The API requires `MailingStateCode` / `MailingCountryCode` (ISO codes) instead
of free-text names.

**Fix (automatic):** The app detects this capability per-org and automatically
normalizes address values to ISO codes.  If you still see the error, reconnect
your Salesforce account so the capability cache refreshes.

---

## ‚öôÔ∏è Functionality Deep Dive

* **Connect & Sync:** Users log in with Google. The "Settings" page allows connecting multiple Google accounts, plus LinkedIn and Facebook accounts. For Facebook, after initial connection, users are guided to select a Page for posting. Calendars are synced to a database to populate the dashboard with upcoming events.
* **Record & Transcribe:** On the dashboard, users toggle "Record Meeting?" for desired events. The system extracts meeting links (Zoom, Meet) and uses Recall.ai to dispatch a bot. A background poller (`BotStatusPoller`) checks for completed recordings and transcripts, saving the data to local `Meeting`, `MeetingTranscript`, and `MeetingParticipant` tables.
* **AI Content Generation:**
    * Once a meeting is processed, an `AIContentGenerationWorker` is enqueued.
    * This worker uses Google Gemini to draft a follow-up email.
    * It also processes all active "Automations" defined by the user. For each automation, it combines the meeting data with the user's `prompt_template` and calls Gemini to generate content (e.g., a LinkedIn post), saving it as an `AutomationResult`.
* **Social Posting:**
    * From the "Meeting Details" page, users can view AI-generated email drafts and posts from their automations.
    * "Copy" buttons are available.
    * "Post" buttons allow direct posting to LinkedIn (as the user) and the selected Facebook Page (as the Page).

---

## üîó HubSpot Integration

### HubSpot OAuth Integration

* **Custom Ueberauth Strategy:** Implemented in `lib/ueberauth/strategy/hubspot.ex`
* **OAuth 2.0 Flow:** Handles authorization code flow with HubSpot's `/oauth/authorize` and `/oauth/v1/token` endpoints
* **Credential Storage:** Credentials stored in `user_credentials` table with `provider: "hubspot"`, including `token`, `refresh_token`, and `expires_at`
* **Token Refresh:**
    * `HubspotTokenRefresher` Oban cron worker runs every 5 minutes to proactively refresh tokens expiring within 10 minutes
    * Internal `with_token_refresh/2` wrapper automatically refreshes expired tokens on API calls and retries the request
    * Refresh failures are logged; users are prompted to re-authenticate if refresh token is invalid

### HubSpot Modal UI

* **LiveView Component:** Located at `lib/social_scribe_web/live/meeting_live/hubspot_modal_component.ex`
* **Contact Search:** Debounced input triggers HubSpot API search, results displayed in dropdown
* **AI Suggestions:** Fetched via `HubspotSuggestions.generate_suggestions` which calls Gemini with transcript context
* **Suggestion Cards:** Each card displays:
    * Field label
    * Current value (strikethrough)
    * Arrow
    * Suggested value
    * Timestamp link
* **Selective Updates:** Checkbox per field allows selective updates; "Update HubSpot" button disabled until at least one field selected
* **Form Submission:** Batch-updates selected contact properties via `HubspotApi.update_contact`
* **Click-away Handler:** Closes dropdown without clearing selection

---

## üîó Salesforce Integration

### Creating a Salesforce Connected App

1. Log in to your Salesforce org and go to **Setup ‚Üí App Manager**.
2. Click **New Connected App**.
3. Fill in the basic info (name, contact email).
4. Enable **OAuth Settings**:
   * **Callback URL:** `http://localhost:4000/auth/salesforce/callback`
     (use your production domain in production)
   * **Selected OAuth Scopes:** add `api`, `refresh_token`, `offline_access`
5. Save. After saving, Salesforce generates a **Consumer Key** (client ID) and
   **Consumer Secret** ‚Äî copy both.
6. Under **OAuth Policies**, set *Permitted Users* to *All users may self-authorize*.

### Required Environment Variables

| Variable | Description |
|---|---|
| `SALESFORCE_CLIENT_ID` | Connected App Consumer Key |
| `SALESFORCE_CLIENT_SECRET` | Connected App Consumer Secret |
| `SALESFORCE_SITE` | *(optional)* Login domain ‚Äî `https://login.salesforce.com` (default) or `https://test.salesforce.com` for sandboxes |

### How the Integration Works

* **OAuth flow:** Users click *Connect Salesforce* on the Settings page.
  The custom Ueberauth strategy redirects to Salesforce, captures the access
  token **and** the org-specific `instance_url`, then stores both in the
  `user_credentials` table (`metadata["instance_url"]`).
* **Meeting modal:** On any processed meeting page an *Update Salesforce*
  card is shown when a Salesforce account is connected.  Clicking it opens a
  modal where users can:
  1. **Search contacts** ‚Äî live search against the org's Contact records using
     a SOQL `LIKE` query.
  2. **AI suggestions** ‚Äî after selecting a contact, Gemini analyses the
     meeting transcript and suggests field updates (`Phone`, `Title`,
     `MailingCity`, etc.).
  3. **Review & apply** ‚Äî each suggested field is shown alongside the current
     Salesforce value.  Users tick the fields they want to update and click
     *Update Salesforce*.

### Salesforce API Client

* Located at `lib/social_scribe/salesforce_api.ex`
* Uses the Salesforce **REST API v59.0**
* Every request uses the Bearer token from the credential and the
  org-specific base URL from `metadata["instance_url"]`
* `search_contacts/2` ‚Äî SOQL `SELECT ‚Ä¶ FROM Contact WHERE Name LIKE '%‚Ä¶%' LIMIT 10`
* `get_contact/2` ‚Äî `GET /sobjects/Contact/{id}?fields=‚Ä¶`
* `update_contact/3` ‚Äî `PATCH /sobjects/Contact/{id}` (returns HTTP 204 on success)

### Testability

All Salesforce API calls are behind `SocialScribe.SalesforceApiBehaviour`.
In tests the implementation is swapped for `SocialScribe.SalesforceApiMock`
(configured in `test/test_helper.exs` via Mox).  See
`test/social_scribe_web/live/salesforce_modal_mox_test.exs` for integration
tests and `test/social_scribe/salesforce_suggestions_test.exs` for unit tests.

### Troubleshooting

| Symptom | Fix |
|---|---|
| `ArgumentError: Salesforce credential is missing instance_url` | Re-connect the Salesforce account; the `instance_url` was not captured correctly during OAuth |
| 401 Unauthorized on API calls | The access token has expired; re-connect the Salesforce account |
| No contacts found | Verify the user has `Read` permission on the `Contact` object in the connected org |
| Sandbox org redirect | Set `SALESFORCE_SITE=https://test.salesforce.com` and update the Connected App callback URL accordingly |

---

## ‚ö†Ô∏è Known Issues & Limitations

* **Facebook Posting & App Review:**
    * Posting to Facebook is implemented via the Graph API to a user-managed Page.
    * Full functionality for all users (especially those not app administrators/developers/testers) typically requires a thorough app review process by Meta, potentially including Business Verification. This is standard for apps using Page APIs.
    * During development, posting will be most reliable for app admins to Pages they directly manage.
* **Error Handling & UI Polish:** While core paths are robustly handled, comprehensive error feedback for all API edge cases and advanced UI polish are areas for continued development beyond the initial 48-hour scope.
* **Prompt Templating for Automations:** The current automation prompt templating is basic (string replacement). A more sophisticated templating engine (e.g., EEx or a dedicated library) would be a future improvement.
* **Agenda Integration:** Currently we only sync when the calendar event has a `hangoutLink` or `location` field with a zoom or google meet link.
---

## üìö Learn More (Phoenix Framework)

* Official website: https://www.phoenixframework.org/
* Guides: https://hexdocs.pm/phoenix/overview.html
* Docs: https://hexdocs.pm/phoenix
* Forum: https://elixirforum.com/c/phoenix-forum
* Source: https://github.com/phoenixframework/phoenix